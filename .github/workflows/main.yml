name: Build Flet App

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.8'

    - name: Upgrade and Reinstall Flet CLI
      run: |
        pip install flet-cli --upgrade
        # 如果升级后问题依旧，尝试完全重新安装
        # pip uninstall -y flet-cli
        # pip install flet-cli
        
    - name: Install Project Dependencies
      run: |
        pip install flet  # 确保安装了 Flet 库[citation:6]
        # 在此添加你项目可能需要的其他依赖，例如 requests, tqdm 等[citation:5]
        
    - name: Build APK
      run: |
        flet build apk --include-packages subprocess,platform,pathlib,requests,tqdm
        flet build ipa --include-packages subprocess,platform,pathlib,requests,tqdm
        flet build windows --include-packages subprocess,platform,pathlib,requests,tqdm --name "PyEdit IDE"
